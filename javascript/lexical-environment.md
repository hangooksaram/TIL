# Lexical Environment

[Lexical Environment 와 Closure에 대한 이해](https://velog.io/@paulkim/e)

[변수의 유효범위와 클로저](https://ko.javascript.info/closure)

[JS Execution Context (실행 컨텍스트) 란? | 감구마 개발블로그](https://gamguma.dev/post/2022/04/js_execution_context)

1. 함수는 `호출` 될 때 마다 실행 컨텍스트 (Excution Context) 라는 것이 생성 된다. 모든 스크립트는 실행 될 때 전역 실행 컨텍스트 가 생성된다. 자바스크립트는 이러한 실행 컨텍스트 들을 콜스택에 담아 선입후출 로 실행한다.
2. 실행 컨텍스트는 두가지 단계가 있다
   1. 생성 단계 : 컨텍스트 는 만들어졌으나 깨어 있지 (실행) 않은 상태를 의미한다. 함수가 호출되는 순간 생성단계는 이미 실행된다.
      1. VariableEnvironent 객체가 생성된다.
      2. This 의 값이 결정된다
      3. 최초로 변수들을 선언해 `undefined` 값을 할당한다.
   2. 실행 단계 : 컨텍스트가 깨어 나는 상태를 의미한다.
      1. 변수들에 실제 값이 할당 된다.
3. 실행컨텍스트 내부 에는 This Binding, Variable Environment, Lexical Environment 가 있다.

## Lexical Environment

- 자바스크립트에서는 실행 중인 함수, 코드 블록 (`{...}`), 스크립트 전체 는 *렉시컬 환경(Lexical Environment)* 이라 불리는 내부 숨김 연관 객체(internal hidden associated object)를 가진다.
- 렉시컬 환경은 Environment Record (환경 레코드) 와 Outer Lexical Environment (외부 렉시컬 환경) 에 대한 참조로 구성되어 있다.

  - Environment Record : 모든 지역 변수를 프로퍼티로 저장하고 있는 객체. `this` 값과 같은 기타 정보도 여기에 저장된다.
      <aside>
      ✋🏻 *그렇기 때문에 변수라는 것은 라는 특수 내부 **객체** 인 `환경 레코드` 의 **프로퍼티** 인 것이다. '변수를 가져오거나 변경’ 하는 것은 '환경 레코드의 프로퍼티를 가져오거나 변경’ 함을 의미한다.*
      
      </aside>

  - Outer Lexical Environment : 함수 밖의 렉시컬 환경

- 함수가 실행되면 스크립트 내의 모든 변수와 함수는 렉시컬 환경 에 올라간다.
  - 변수
    1. 렉시컬 환경에 올라가자 마자 uninitiallized 라는 특수 내부 상태를 갖는다. 이는 let, const 같은 키워드를 만나기 변수가 `선언` 되기 전 의 상태로, 참조할 수 없다. 이 상태는 TDZ 라고 불리는 영역이라고 할수있다.
    2. 키워드를 통해 변수가 선언되면, 그때 부터 해당 변수는 스코프 체인 등에 참조된다.
  - 함수
    - 함수도 변수와 같지만 `function say (name) …` 과 같은 형태인 `함수 선언문` 으로 선언한 함수에 한해서, 키워드(let, const ..) 를 만나야 사용할 수 있는 변수와 달리, 함수 선언문으로 선언한 함수는 바로 사용할 수 있다. 이는 변수에 함수를 할당하는 형식의 함수에서는 적용되지 않는다.
- 함수가 호출되어 실행되면, 해당 함수의 렉시컬 환경에는, 매개변수, 함수 내 지역변수 에 대한 정보가 있다. 그리고 함수를 호출하는 동안 함수의 내부 렉시컬 환경과, 내부 렉시컬 환경이 참조하는 외부 렉시컬 환경을 가지게 된다.
- 변수에 접근할 때는 렉시컬 환경을 검색 범위로 사용된다. 내부 렉시컬 환경에서 변수를 찾지 못하면 외부 렉시컬 환경으로 검색 범위를 확장한다. 이 과정은 변수를 찾을 때까지, 최종적으로 전역 렉시컬 환경까지 반복된다.

## Hoisting

- 흔히 `끌어올려지다` 라고 알려져 있는, 변수가 선언되기 전에 변수에 접근할 수 있게 되는 현상을 일컫는다.
